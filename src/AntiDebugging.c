#include "AntiDebugging.h"

BOOL WINAPI AntiIsDebuggerPressent()
{
	if (IsDebuggerPresent()) {
		MessageBoxA(NULL, "Debugger Found\nIsDebuggerPresent", "Anti Debugging", MB_OK);
		return TRUE;
	}

	return FALSE;
}

BOOL WINAPI AntiCheckRemoteDebuggerPresent()
{
	HANDLE hProcess = INVALID_HANDLE_VALUE;
	BOOL bFound = FALSE;

	hProcess = GetCurrentProcess();
	CheckRemoteDebuggerPresent(hProcess, &bFound);

	if (bFound) {
		MessageBoxA(NULL, "Debugger Found\nCheckRemoteDebuggerPresent", "Anti Debugging", MB_OK);
		return TRUE;
	}

	return FALSE;
}

BOOL WINAPI CheckWindows()
{
	BOOL bFound = FALSE;
	HANDLE hWindow = NULL;
	LPCSTR IDAPro = "Qt5QWindowIcon";
	LPCSTR Olly = "OLLYDBG";
	LPCSTR Immunity = "ID";


	hWindow = FindWindow(IDAPro, 0x0);
	if (hWindow) {
		bFound = TRUE;
	}
	hWindow = FindWindow(Olly, 0x0);
	if (hWindow) {
		bFound = TRUE;
	}
	hWindow = FindWindow(Immunity, 0x0);
	if (hWindow) {
		bFound = TRUE;
	}

	if (bFound) {
		return TRUE;
	}

	return FALSE;
}

BOOL WINAPI AntiNtGlobalFlagPEB()
{
	BOOL bFound = FALSE;

	_asm {
		xor eax, eax // Clear EAX register
		mov eax, fs:[0x30] // Start of the PEB
		mov eax, [eax + 0x68] // PEB+0x68
		and eax, 0x00000070 // Check flags
		mov bFound, eax;
	}

	if (bFound) {
		return TRUE;
	}

	return FALSE;
}


